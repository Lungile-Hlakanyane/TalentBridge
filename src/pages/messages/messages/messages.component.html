<div class="messages-container">

  <!-- Back Button -->
  <div class="action-back-container">
    <span class="back-text" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Back
    </span>
  </div>

  <h2 class="page-title">Messages</h2>

  <div class="chat-wrapper">
    <!-- LEFT: User List Panel -->
    <div class="user-list-panel">
      <!-- Search & Filter Tabs -->
      <div class="search-filter-container">
        <!-- Search Bar -->
        <input
          type="text"
          placeholder="Search users by name or surname..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="filterUsers()"
          class="search-input"
        />

        <!-- Tabs -->
        <div class="tabs-container">
          <button
            *ngFor="let tab of tabs"
            (click)="selectTab(tab)"
            [class.active]="selectedTab === tab"
          >
            {{ tab }}
          </button>
        </div>
      </div>

      <!-- Users List -->
     <div class="chat-card"
  *ngFor="let user of filteredUsers"
  [class.active-chat]="activeUser?.id === user.id"
  (click)="selectUser(user)"
>
  <div class="chat-item">
    <img
      src="../../../assets/avatar_employer.png"
      alt="User Avatar"
      class="avatar"
      onerror="this.src='assets/images/default-avatar.png'"
    />

    <div class="chat-details">
      <h4>{{ user.name }} {{ user.surname }}</h4>

      <!-- âœ… Show company name for employers only -->
      <p class="company-name" *ngIf="user.userType === 'Employer' && user.companyName">
        {{ user.companyName }}
      </p>
    </div>

    <button
      class="send-invite-btn"
      (click)="sendInvite(user, $event)"
      [disabled]="user.inviteStatus === 'PENDING' || user.inviteStatus === 'ACCEPTED'">
      {{ user.inviteStatus === 'ACCEPTED' ? 'Invited' :
         user.inviteStatus === 'PENDING' ? 'Pending...' : 'Send Invite' }}
    </button>

  </div>
  
</div>


        <!-- Empty State -->
        <div *ngIf="filteredUsers.length === 0" class="no-results">
          <p>No users found.</p>
        </div>

      </div>
    </div>

    <!-- RIGHT: Chat Panel -->
    <div class="chat-panel" *ngIf="activeUser">
  <div class="chat-header">
    <div class="chat-header-info">
      <div>
        <h3>{{ activeUser.name }} {{ activeUser.surname }}</h3>
        <p class="chat-role">
          {{ activeUser.userType }}
          <span *ngIf="activeUser.userType === 'Employer' && activeUser.companyName">
            â€¢ {{ activeUser.companyName }}
          </span>
        </p>
      </div>
    </div>

    <button class="view-profile-btn" (click)="viewProfile(activeUser)">
      View Profile
    </button>
  </div>

  <!-- Chat History -->
  <div class="chat-history">
    <div
      *ngFor="let msg of messages"
      [class.sent]="msg.senderId === currentUserId"
      [class.received]="msg.senderId !== currentUserId"
      class="chat-bubble"
    >
      <p>{{ msg.message }}</p>
      <span class="timestamp">{{ msg.timestamp | date:'shortTime' }}</span>
    </div>
  </div>

  <!-- Input -->
  <div class="chat-input-container">
    <input
      type="text"
      placeholder="Type your message..."
      [(ngModel)]="newMessage"
    />
    <button (click)="sendMessage()">
      <img src="../../../assets/send-message-icon.svg" style="width:25px; height: 25px;">
    </button>
  </div>


<!-- Empty Chat State -->
<div class="chat-panel empty" *ngIf="!activeUser">
  <p>Select a user to start chatting ðŸ’¬</p>
</div>

  </div>

</div>
